(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{354:function(t,s,n){"use strict";n.r(s);var a=n(43),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"api"}},[t._v("API")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/yjs/yjs#api",target:"_blank",rel:"noopener noreferrer"}},[t._v("英文原地址"),n("OutboundLink")],1)]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'yjs'")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("h2",{attrs:{id:"共享类型"}},[n("em",[t._v("共享类型")])]),t._v(" "),n("h2",{attrs:{id:"y-array"}},[t._v("Y.Array")]),t._v(" "),n("p",[t._v("一种可共享的类数组类型，支持在任何位置插入/删除元素。在内部，它使用了数组链表，必要时可以分割数组。")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" yarray "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Array")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("h3",{attrs:{id:"insert-index-number-content-array-object-boolean-array-string-number-uint8array-y-type"}},[n("code",[t._v("insert(index:number, content:Array<object|boolean|Array|string|number|Uint8Array|Y.Type>)")])]),t._v(" "),n("p",[t._v("在"),n("code",[t._v("index")]),t._v("处插入内容。请注意内容是元素的数组。"),n("code",[t._v("array.insert(0, [1])")]),t._v("在索引"),n("code",[t._v("0")]),t._v("处拼接列表并插入"),n("code",[t._v("1")]),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"push-array-object-boolean-array-string-number-uint8array-y-type"}},[n("code",[t._v("push(Array<Object|boolean|Array|string|number|Uint8Array|Y.Type>)")])]),t._v(" "),n("h3",{attrs:{id:"unshift-array-object-boolean-array-string-number-uint8array-y-type"}},[n("code",[t._v("unshift(Array<Object|boolean|Array|string|number|Uint8Array|Y.Type>)")])]),t._v(" "),n("h3",{attrs:{id:"delete-index-number-length-number"}},[n("code",[t._v("delete(index:number, length:number)")])]),t._v(" "),n("h3",{attrs:{id:"get-index-number"}},[n("code",[t._v("get(index:number)")])]),t._v(" "),n("h3",{attrs:{id:"length-number"}},[n("code",[t._v("length:number")])]),t._v(" "),n("h3",{attrs:{id:"foreach-function-value-object-boolean-array-string-number-uint8array-y-type-index-number-array-y-array"}},[n("code",[t._v("forEach(function(value:object|boolean|Array|string|number|Uint8Array|Y.Type, index:number, array: Y.Array))")])]),t._v(" "),n("h3",{attrs:{id:"map-function-t-number-yarray-m-array-m"}},[n("code",[t._v("map(function(T, number, YArray):M):Array<M>")])]),t._v(" "),n("h3",{attrs:{id:"toarray-array-object-boolean-array-string-number-uint8array-y-type"}},[n("code",[t._v("toArray():Array<object|boolean|Array|string|number|Uint8Array|Y.Type>")])]),t._v(" "),n("p",[t._v("将该"),n("code",[t._v("YArray")]),t._v("的内容拷贝到一个新数组中。")]),t._v(" "),n("h3",{attrs:{id:"tojson-array-object-boolean-array-string-number"}},[n("code",[t._v("toJSON():Array<Object|boolean|Array|string|number>")])]),t._v(" "),n("p",[t._v("将该"),n("code",[t._v("YArray")]),t._v("的内容拷贝到一个新数组中。该方法会使用"),n("code",[t._v("toJSON")]),t._v("方法将所有子类型转换为 JSON。")]),t._v(" "),n("h3",{attrs:{id:"symbol-iterator"}},[n("code",[t._v("[Symbol.Iterator]")])]),t._v(" "),n("p",[t._v("返回一个"),n("code",[t._v("YArray")]),t._v("迭代器，其中包含了数组中每个索引的值。")]),t._v(" "),n("p",[n("code",[t._v("for (let value of yarray) { .. }")])]),t._v(" "),n("h3",{attrs:{id:"observe-function-yarrayevent-transaction-void"}},[n("code",[t._v("observe(function(YArrayEvent, Transaction):void)")])]),t._v(" "),n("p",[t._v("向该类型添加一个事件侦听器，该事件侦听器将在每次修改这个类型时同步调用。如果在事件侦听器中修改了此类型，则在当前事件侦听器返回后将再次调用事件侦听器。")]),t._v(" "),n("h3",{attrs:{id:"unobserve-function-yarrayevent-transaction-void"}},[n("code",[t._v("unobserve(function(YArrayEvent, Transaction):void)")])]),t._v(" "),n("p",[t._v("从该类型中删除"),n("code",[t._v("observe")]),t._v("事件侦听器。")]),t._v(" "),n("h3",{attrs:{id:"observedeep-function-array-yevent-transaction-void"}},[n("code",[t._v("observeDeep(function(Array<YEvent>, Transaction):void)")])]),t._v(" "),n("p",[t._v("向该类型添加一个事件侦听器，该事件侦听器将在每次修改此类型或其任何子类型时同步调用。如果在事件侦听器中修改了此类型，则在当前事件侦听器返回后将再次调用事件侦听器。事件侦听器接收自己或其子程序创建的所有事件。")]),t._v(" "),n("h3",{attrs:{id:"unobservedeep-function-array-yevent-transaction-void"}},[n("code",[t._v("unobserveDeep(function(Array<YEvent>, Transaction):void)")])]),t._v(" "),n("p",[t._v("从该类型中删除"),n("code",[t._v("observeDeep")]),t._v("事件监听器。")]),t._v(" "),n("h2",{attrs:{id:"y-map"}},[t._v("Y.Map")]),t._v(" "),n("p",[t._v("共享 Map 类型。")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ymap "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("h3",{attrs:{id:"get-key-string-object-boolean-string-number-uint8array-y-type"}},[n("code",[t._v("get(key:string):object|boolean|string|number|Uint8Array|Y.Type")])]),t._v(" "),n("h3",{attrs:{id:"set-key-string-value-object-boolean-string-number-uint8array-y-type"}},[n("code",[t._v("set(key:string, value:object|boolean|string|number|Uint8Array|Y.Type)")])]),t._v(" "),n("h3",{attrs:{id:"delete-key-string"}},[n("code",[t._v("delete(key:string)")])]),t._v(" "),n("h3",{attrs:{id:"has-key-string-boolean"}},[n("code",[t._v("has(key:string):boolean")])]),t._v(" "),n("h3",{attrs:{id:"get-index-number-2"}},[n("code",[t._v("get(index:number)")])]),t._v(" "),n("h3",{attrs:{id:"tojson-object-string-object-boolean-array-string-number-uint8array"}},[n("code",[t._v("toJSON():Object<string, Object|boolean|Array|string|number|Uint8Array>")])]),t._v(" "),n("p",[t._v("将该"),n("code",[t._v("YMap")]),t._v("的"),n("code",[t._v("[key,value]")]),t._v("对复制到一个新对象。它使用"),n("code",[t._v("toJSON")]),t._v("方法将所有子类型转换为JSON。")]),t._v(" "),n("h3",{attrs:{id:"foreach-function-value-object-boolean-array-string-number-uint8array-y-type-key-string-map-y-map"}},[n("code",[t._v("forEach(function(value:object|boolean|Array|string|number|Uint8Array|Y.Type, key:string, map: Y.Map))")])]),t._v(" "),n("p",[t._v("对每个键值对执行一次传入的函数。")]),t._v(" "),n("h3",{attrs:{id:"symbol-iterator-2"}},[n("code",[t._v("[Symbol.Iterator]")])]),t._v(" "),n("p",[t._v("返回迭代器的"),n("code",[t._v("[key, value]")]),t._v("对。")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" ymap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("h3",{attrs:{id:"entries"}},[n("code",[t._v("entries()")])]),t._v(" "),n("p",[t._v("返回迭代器的"),n("code",[t._v("[key, value]")]),t._v("对。")]),t._v(" "),n("h3",{attrs:{id:"values"}},[n("code",[t._v("values")])]),t._v(" "),n("p",[t._v("返回迭代器的所有值。")]),t._v(" "),n("h3",{attrs:{id:"keys"}},[n("code",[t._v("keys")])]),t._v(" "),n("p",[t._v("返回迭代器的所有键。")]),t._v(" "),n("h3",{attrs:{id:"observe-function-ymapevent-transaction-void"}},[n("code",[t._v("observe(function(YMapEvent, Transaction):void)")])]),t._v(" "),n("p",[t._v("向该类型添加一个事件侦听器，该事件侦听器将在每次修改这个类型时同步调用。如果在事件侦听器中修改了此类型，则在当前事件侦听器返回后将再次调用事件侦听器。")]),t._v(" "),n("h3",{attrs:{id:"unobserve-function-ymapevent-transaction-void"}},[n("code",[t._v("unobserve(function(YMapEvent, Transaction):void)")])]),t._v(" "),n("p",[t._v("从该类型中删除"),n("code",[t._v("observe")]),t._v("事件侦听器。")]),t._v(" "),n("h3",{attrs:{id:"observedeep-function-array-yevent-transaction-void-2"}},[n("code",[t._v("observeDeep(function(Array<YEvent>, Transaction):void)")])]),t._v(" "),n("p",[t._v("向该类型添加一个事件侦听器，该事件侦听器将在每次修改此类型或其任何子类型时同步调用。如果在事件侦听器中修改了此类型，则在当前事件侦听器返回后将再次调用事件侦听器。事件侦听器接收自己或其子程序创建的所有事件。")]),t._v(" "),n("h3",{attrs:{id:"unobservedeep-function-array-yevent-transaction-void-2"}},[n("code",[t._v("unobserveDeep(function(Array<YEvent>, Transaction):void)")])]),t._v(" "),n("p",[t._v("从该类型中删除"),n("code",[t._v("observeDeep")]),t._v("事件监听器。")]),t._v(" "),n("h2",{attrs:{id:"y-text"}},[t._v("Y.Text")]),t._v(" "),n("p",[t._v("为文本的共享编辑而优化的可共享类型。它允许在文本中将属性分配给范围。这让视线该类型的服务文绑定成为可能。")]),t._v(" "),n("p",[t._v("该类型还可以转换为"),n("a",{attrs:{href:"https://quilljs.com/docs/delta",target:"_blank",rel:"noopener noreferrer"}},[t._v("delta format"),n("OutboundLink")],1),t._v("。同样地，"),n("code",[t._v("YTextEvents")]),t._v("计算增量变化。")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ytext "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Text")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("h3",{attrs:{id:"insert-index-number-content-string-formattingattributes-object-string-string"}},[n("code",[t._v("insert(index:number, content:string, [formattingAttributes:Object<string,string>])")])]),t._v(" "),n("p",[t._v("在"),n("code",[t._v("index")]),t._v("处插入一个字符串，并为其分配格式化属性。")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("ytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bold text'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" bold"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("h3",{attrs:{id:"delete-index-number-length-number-2"}},[n("code",[t._v("delete(index:number, length:number)")])]),t._v(" "),n("h3",{attrs:{id:"format-index-number-length-number-formattingattributes-object-string-string"}},[n("code",[t._v("format(index:number, length:number, formattingAttributes:Object<string,string>)")])]),t._v(" "),n("p",[t._v("为文本中的的一定范围指定格式化属性。")]),t._v(" "),n("h3",{attrs:{id:"applydelta-delta-opts-object-string-any"}},[n("code",[t._v("applyDelta(delta, opts:Object<string,any>)")])]),t._v(" "),n("p",[t._v("参见"),n("a",{attrs:{href:"https://quilljs.com/docs/delta/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Quill Delta"),n("OutboundLink")],1),t._v("可以设置防止删除结束换行的配置项，默认为"),n("code",[t._v("true")]),t._v("。")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("ytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("applyDelta")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("delta"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" sanitize"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("h3",{attrs:{id:"length-number-2"}},[n("code",[t._v("length:number")])]),t._v(" "),n("h3",{attrs:{id:"tostring-string"}},[n("code",[t._v("toString():string")])]),t._v(" "),n("p",[t._v("在不使用格式化配置项的情况下，将此类型转换为字符串。")]),t._v(" "),n("h3",{attrs:{id:"tojson-string"}},[n("code",[t._v("toJSON():string")])]),t._v(" "),n("p",[t._v("参见"),n("code",[t._v("toString")])]),t._v(" "),n("h3",{attrs:{id:"todelta-delta"}},[n("code",[t._v("toDelta():Delta")])]),t._v(" "),n("p",[t._v("将该类型转换为"),n("a",{attrs:{href:"https://quilljs.com/docs/delta/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Quill Delta"),n("OutboundLink")],1)]),t._v(" "),n("h3",{attrs:{id:"observe-function-ytextevent-transaction-void"}},[n("code",[t._v("observe(function(YTextEvent, Transaction):void)")])]),t._v(" "),n("p",[t._v("向该类型添加一个事件侦听器，该事件侦听器将在每次修改这个类型时同步调用。如果在事件侦听器中修改了此类型，则在当前事件侦听器返回后将再次调用事件侦听器。")]),t._v(" "),n("h3",{attrs:{id:"unobserve-function-ytextevent-transaction-void"}},[n("code",[t._v("unobserve(function(YTextEvent, Transaction):void)")])]),t._v(" "),n("p",[t._v("从该类型中删除"),n("code",[t._v("observe")]),t._v("事件侦听器。")]),t._v(" "),n("h3",{attrs:{id:"observedeep-function-array-yevent-transaction-void-3"}},[n("code",[t._v("observeDeep(function(Array<YEvent>, Transaction):void)")])]),t._v(" "),n("p",[t._v("向该类型添加一个事件侦听器，该事件侦听器将在每次修改此类型或其任何子类型时同步调用。如果在事件侦听器中修改了此类型，则在当前事件侦听器返回后将再次调用事件侦听器。事件侦听器接收自己或其子程序创建的所有事件。")]),t._v(" "),n("h3",{attrs:{id:"unobservedeep-function-array-yevent-transaction-void-3"}},[n("code",[t._v("unobserveDeep(function(Array<YEvent>, Transaction):void)")])]),t._v(" "),n("p",[t._v("从该类型中删除"),n("code",[t._v("observeDeep")]),t._v("事件监听器。")]),t._v(" "),n("h2",{attrs:{id:"y-xmlfragment"}},[t._v("Y.XmlFragment")]),t._v(" "),n("p",[t._v("包含"),n("code",[t._v("Y.XmlElements")]),t._v("数组的容器。")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" yxml "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("XmlFragment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("h3",{attrs:{id:"insert-index-number-content-array-y-xmlelement-y-xmltext"}},[n("code",[t._v("insert(index:number, content:Array<Y.XmlElement|Y.XmlText>)")])]),t._v(" "),n("h3",{attrs:{id:"delete-index-number-length-number-3"}},[n("code",[t._v("delete(index:number, length:number)")])]),t._v(" "),n("h3",{attrs:{id:"get-index-number-3"}},[n("code",[t._v("get(index:number)")])]),t._v(" "),n("h3",{attrs:{id:"length-number-3"}},[n("code",[t._v("length:number")])]),t._v(" "),n("h3",{attrs:{id:"toarray-array-y-xmlelement-y-xmltext"}},[n("code",[t._v("toArray():Array<Y.XmlElement|Y.XmlText>")])]),t._v(" "),n("p",[t._v("将子元素拷贝到一个新数组。")]),t._v(" "),n("h3",{attrs:{id:"todom-documentfragment"}},[n("code",[t._v("toDOM():DocumentFragment")])]),t._v(" "),n("p",[t._v("将此类型和所有子元素转换为新的 DOM 元素。")]),t._v(" "),n("h3",{attrs:{id:"tostring-string-2"}},[n("code",[t._v("toString():string")])]),t._v(" "),n("p",[t._v("获取所有后代的 XML 序列化。")]),t._v(" "),n("h3",{attrs:{id:"tojson-string-2"}},[n("code",[t._v("toJSON():string")])]),t._v(" "),n("p",[t._v("参见"),n("code",[t._v("toString")])]),t._v(" "),n("h3",{attrs:{id:"observe-function-yxmlevent-transaction-void"}},[n("code",[t._v("observe(function(YXmlEvent, Transaction):void)")])]),t._v(" "),n("p",[t._v("向该类型添加一个事件侦听器，该事件侦听器将在每次修改这个类型时同步调用。如果在事件侦听器中修改了此类型，则在当前事件侦听器返回后将再次调用事件侦听器。")]),t._v(" "),n("h3",{attrs:{id:"unobserve-function-yxmlevent-transaction-void"}},[n("code",[t._v("unobserve(function(YXmlEvent, Transaction):void)")])]),t._v(" "),n("p",[t._v("从该类型中删除"),n("code",[t._v("observe")]),t._v("事件侦听器。")]),t._v(" "),n("h3",{attrs:{id:"observedeep-function-array-yevent-transaction-void-4"}},[n("code",[t._v("observeDeep(function(Array<YEvent>, Transaction):void)")])]),t._v(" "),n("p",[t._v("向该类型添加一个事件侦听器，该事件侦听器将在每次修改此类型或其任何子类型时同步调用。如果在事件侦听器中修改了此类型，则在当前事件侦听器返回后将再次调用事件侦听器。事件侦听器接收自己或其子程序创建的所有事件。")]),t._v(" "),n("h3",{attrs:{id:"unobservedeep-function-array-yevent-transaction-void-4"}},[n("code",[t._v("unobserveDeep(function(Array<YEvent>, Transaction):void)")])]),t._v(" "),n("p",[t._v("从该类型中删除"),n("code",[t._v("observeDeep")]),t._v("事件监听器。")]),t._v(" "),n("h2",{attrs:{id:"t-xmlelement"}},[t._v("T.XmlElement")]),t._v(" "),n("p",[t._v("表示 XML 元素的可共享类型。它拥有"),n("code",[t._v("nodeName")]),t._v("、属性和一系列子节点。但是它不需要验证其内容，也不需要遵循 XML。")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" yxml "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("XmlElement")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("h3",{attrs:{id:"insert-index-number-content-array-y-xmlelement-y-xmltext-2"}},[n("code",[t._v("insert(index:number, content:Array<Y.XmlElement|Y.XmlText>)")])]),t._v(" "),n("h3",{attrs:{id:"delete-index-number-length-number-4"}},[n("code",[t._v("delete(index:number, length:number)")])]),t._v(" "),n("h3",{attrs:{id:"get-index-number-4"}},[n("code",[t._v("get(index:number)")])]),t._v(" "),n("h3",{attrs:{id:"length-number-4"}},[n("code",[t._v("length:number")])]),t._v(" "),n("h3",{attrs:{id:"setattribute-attributename-string-attributevalue-string"}},[n("code",[t._v("setAttribute(attributeName:string, attributeValue:string)")])]),t._v(" "),n("h3",{attrs:{id:"removeattribute-attributename-string"}},[n("code",[t._v("removeAttribute(attributeName:string)")])]),t._v(" "),n("h3",{attrs:{id:"getattribute-attributename-string-string"}},[n("code",[t._v("getAttribute(attributeName:string):string")])]),t._v(" "),n("h3",{attrs:{id:"getattributes-attributename-string-object-string-string"}},[n("code",[t._v("getAttributes(attributeName:string):Object<string,string>")])]),t._v(" "),n("h3",{attrs:{id:"toarray-array-y-xmlelement-y-xmltext-2"}},[n("code",[t._v("toArray():Array<Y.XmlElement|Y.XmlText>")])]),t._v(" "),n("p",[t._v("将子元素拷贝到一个新数组。")]),t._v(" "),n("h3",{attrs:{id:"todom-element"}},[n("code",[t._v("toDOM():Element")])]),t._v(" "),n("p",[t._v("将此类型和所有子元素转换为新的 DOM 元素。")]),t._v(" "),n("h3",{attrs:{id:"tostring-string-3"}},[n("code",[t._v("toString():string")])]),t._v(" "),n("p",[t._v("获取所有后代的 XML 序列化。")]),t._v(" "),n("h3",{attrs:{id:"tojson-string-3"}},[n("code",[t._v("toJSON():string")])]),t._v(" "),n("p",[t._v("参见"),n("code",[t._v("toString")]),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"observe-function-yxmlevent-transaction-void-2"}},[n("code",[t._v("observe(function(YXmlEvent, Transaction):void)")])]),t._v(" "),n("p",[t._v("向该类型添加一个事件侦听器，该事件侦听器将在每次修改这个类型时同步调用。如果在事件侦听器中修改了此类型，则在当前事件侦听器返回后将再次调用事件侦听器。")]),t._v(" "),n("h3",{attrs:{id:"unobserve-function-yxmlevent-transaction-void-2"}},[n("code",[t._v("unobserve(function(YXmlEvent, Transaction):void)")])]),t._v(" "),n("p",[t._v("从该类型中删除"),n("code",[t._v("observe")]),t._v("事件侦听器。")]),t._v(" "),n("h3",{attrs:{id:"observedeep-function-array-yevent-transaction-void-5"}},[n("code",[t._v("observeDeep(function(Array<YEvent>, Transaction):void)")])]),t._v(" "),n("p",[t._v("向该类型添加一个事件侦听器，该事件侦听器将在每次修改此类型或其任何子类型时同步调用。如果在事件侦听器中修改了此类型，则在当前事件侦听器返回后将再次调用事件侦听器。事件侦听器接收自己或其子程序创建的所有事件。")]),t._v(" "),n("h3",{attrs:{id:"unobservedeep-function-array-yevent-transaction-void-5"}},[n("code",[t._v("unobserveDeep(function(Array<YEvent>, Transaction):void)")])]),t._v(" "),n("p",[t._v("从该类型中删除"),n("code",[t._v("observeDeep")]),t._v("事件监听器。")]),t._v(" "),n("h2",{attrs:{id:"y-doc"}},[t._v("Y.Doc")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" doc "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Doc")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("h3",{attrs:{id:"clientid"}},[n("code",[t._v("clientID")]),t._v(" "),n("Badge",{attrs:{text:"readonly",type:"warning"}})],1),t._v(" "),n("p",[t._v("表示客户的唯一ID。")]),t._v(" "),n("h3",{attrs:{id:"gc"}},[n("code",[t._v("gc")])]),t._v(" "),n("p",[t._v("是否在该 doc 实例上启用了垃圾回收机制(Garbage Collection)。设置"),n("code",[t._v("doc.gc = false")]),t._v("以禁用垃圾回收并能够恢复旧内容。")]),t._v(" "),n("h3",{attrs:{id:"transact-function-transaction-void-origin-any"}},[n("code",[t._v("transact(function(Transaction):void [, origin:any])")])]),t._v(" "),n("p",[t._v("对共享文档的每个更改都发生在一个事件流程(transaction)中。观察者调用和更新事物是在每个事件流程后。您应该将更改放到单个事件流程中以降低事件调用的数量。举个例子，"),n("code",[t._v("doc.transact(() => { yarray.insert(..); ymap.set(..) })")]),t._v("触发单个的更改事件。")]),t._v(" "),n("p",[t._v("您可以通过设置可选参数"),n("code",[t._v("origin")]),t._v("，存储在"),n("code",[t._v("transaction.origin")]),t._v("和"),n("code",[t._v("on('update', (update, origin) => ..)")]),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"tojson-any"}},[n("code",[t._v("toJSON():any")])]),t._v(" "),n("p",[t._v("将整个文档转换为 js 对象，递归遍历每种 yjs 类型。")]),t._v(" "),n("h3",{attrs:{id:"get-string-y-typeclass-type"}},[n("code",[t._v("get(string, Y.[TypeClass]):[Type]")])]),t._v(" "),n("p",[t._v("定义一个共享类型。")]),t._v(" "),n("h3",{attrs:{id:"getarray-string-y-array"}},[n("code",[t._v("getArray(string):Y.Array")])]),t._v(" "),n("p",[t._v("定义一个共享的 Y.Array 类型。等同于"),n("code",[t._v("y.get(string, Y.Array)")]),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"getmap-string-y-map"}},[n("code",[t._v("getMap(string):Y.Map")])]),t._v(" "),n("p",[t._v("定义一个共享的 Y.Map 类型。等同于"),n("code",[t._v("y.get(string, Y.Map)")]),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"getxmlfragment-string-y-xmlfragment"}},[n("code",[t._v("getXmlFragment(string):Y.XmlFragment")])]),t._v(" "),n("p",[t._v("定义一个共享的 Y.XmlFragment 类型。等同于"),n("code",[t._v("y.get(string, Y.XmlFragment)")]),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"on-string-function"}},[t._v("on(string, function)")]),t._v(" "),n("p",[t._v("在共享类型上注册事件侦听器。")]),t._v(" "),n("h3",{attrs:{id:"off-string-function"}},[t._v("off(string, function)")]),t._v(" "),n("p",[t._v("解绑共享类型上的事件侦听器。")]),t._v(" "),n("h2",{attrs:{id:"y-doc-事件"}},[t._v("Y.Doc 事件")]),t._v(" "),n("h3",{attrs:{id:"on-update-function-updatemessage-uint8array-origin-any-y-doc-void"}},[n("code",[t._v("on('update', function(updateMessage:Uint8Array, origin:any, Y.Doc):void)")])]),t._v(" "),n("p",[t._v("侦听文档更新。文档在更新时必须传输到所有其他的展示端。您可以不限顺序且多次的更新文档。")]),t._v(" "),n("h3",{attrs:{id:"on-beforetransaction-function-y-transaction-y-doc-void"}},[n("code",[t._v("on('beforeTransaction', function(Y.Transaction, Y.Doc):void)")])]),t._v(" "),n("p",[t._v("每个事件流程开始前派发。")]),t._v(" "),n("h3",{attrs:{id:"on-aftertransaction-function-y-transaction-y-doc-void"}},[n("code",[t._v("on('afterTransaction', function(Y.Transaction, Y.Doc):void)")])]),t._v(" "),n("p",[t._v("每个事件流程结束后派发。")]),t._v(" "),n("h3",{attrs:{id:"on-beforealltransactions-function-y-doc-void"}},[n("code",[t._v("on('beforeAllTransactions', function(Y.Doc):void)")])]),t._v(" "),n("p",[t._v("事件流程可以嵌套(例如，在一个事件流程中调用另一个事件流程)。在首个事件流程前派发。")]),t._v(" "),n("h3",{attrs:{id:"on-afteralltransactions-function-y-doc-array-y-transaction-void"}},[n("code",[t._v("on('afterAllTransactions', function(Y.Doc, Array<Y.Transaction>):void)")])]),t._v(" "),n("p",[t._v("在最后一个事件流程结束后派发。")]),t._v(" "),n("h2",{attrs:{id:"文档更新"}},[t._v("文档更新")]),t._v(" "),n("p",[t._v("共享文档上的更改被编码到"),n("em",[t._v("文档更新")]),t._v("中。文档更新是"),n("em",[t._v("可交换")]),t._v("且"),n("em",[t._v("幂等")]),t._v("的。这意味着它们可以以任何顺序应用且应用多次。")]),t._v(" "),n("p",[n("strong",[t._v("示例：侦听更新事件并将其应用于远程客户端")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" doc1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Doc")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" doc2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Doc")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ndoc1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'update'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("update")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("applyUpdate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("doc2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ndoc2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'update'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("update")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("applyUpdate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("doc1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 所有的更改也更新到了其他文档中")]),t._v("\ndoc1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getArray")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'myarray'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello doc2, you got this?'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndoc2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getArray")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'myarray'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// => 'Hello doc2, you got this?'")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br")])]),n("p",[t._v("Yjs 在内部维护了**“状态向量”"),n("strong",[t._v("(后面会介绍)，用以表示每个客户端的下一个期望时钟。它保存了每个客户端创建的结构数量。当两个客户端同步时，您既可以交换完整的文档结构，也可以通过发送")]),t._v("“状态向量”**来计算差异。")]),t._v(" "),n("p",[n("strong",[t._v("示例：通过交换完整的文档结构同步两个客户端")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" state1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeStateAsUpdate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ydoc1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" state2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeStateAsUpdate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ydoc2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("applyUpdate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ydoc1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" state2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("applyUpdate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ydoc2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" state1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("p",[n("strong",[t._v("示例：通过计算差异同步两个客户端")])]),t._v(" "),n("p",[t._v("这个例子展示了如何通过使用远程客户端的“状态向量”来计算差异，从而用最少的交换数据同步两个客户端。使用状态向量同步客户端需要另一次往返，但可以保证很大的带宽安全。")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" stateVector1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeStateVector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ydoc1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" stateVector2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeStateVector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ydoc2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" diff1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeStateAsUpdate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ydoc1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" stateVector2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" diff2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeStateAsUpdate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ydoc2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" stateVector1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("applyUpdate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ydoc1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" diff2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("applyUpdate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ydoc2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" diff1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br")])]),n("h3",{attrs:{id:"y-applyupdate-y-doc-update-uint8array-transactionorigin-any"}},[n("code",[t._v("Y.applyUpdate(Y.Doc, update:Uint8Array, [transactionOrigin:any])")])]),t._v(" "),n("p",[t._v("对共享文档应用更新。您可以选择设置"),n("code",[t._v("transactionOrigin")]),t._v("从而将其存储到"),n("code",[t._v("transaction.Origin")]),t._v("和"),n("code",[t._v("ydoc.on('update', (update, origin) => ..)")])]),t._v(" "),n("h3",{attrs:{id:"y-encodestateasupdate-y-doc-encodedtargetstatevector-uint8array-uint8array"}},[n("code",[t._v("Y.encodeStateAsUpdate(Y.Doc, [encodedTargetStateVector:Uint8Array]):Uint8Array")])]),t._v(" "),n("p",[t._v("将文档状态编码为可应用于远程文档的单个更新消息。可以选择指定目标状态向量，以便只将差异写入更新消息。")]),t._v(" "),n("h3",{attrs:{id:"y-encodestatevector-y-doc-uint8array"}},[n("code",[t._v("Y.encodeStateVector(Y.Doc):Uint8Array")])]),t._v(" "),n("p",[t._v("计算状态向量并将其编码为 Uint8Array。")]),t._v(" "),n("h2",{attrs:{id:"相对位置"}},[t._v("相对位置")]),t._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[t._v("警告")]),t._v(" "),n("p",[t._v("该API尚不稳定。")])]),t._v(" "),n("p",[t._v("该特性用于管理选择的内容/光标。当和操作文档的其它用户一起工作时，请不要相信索引位置是你以为的位置。"),n("strong",[t._v("相对位置")]),t._v("会始终保持在共享文档的元素上，不受远程更改的影响。举个例子，在文档中位置是"),n("code",[t._v("“a|c”")]),t._v("则相对位置就会判断到"),n("code",[t._v("c")]),t._v("。若远程用户在光标签插入了文档，光标仍旧会停留在"),n("code",[t._v("c")]),t._v("前。"),n("code",[t._v('insert(1, \'x\')("a|c") = "ax|c"')]),t._v("。当相对位置设置为文档结尾，那么光标就会一直停留在文档结尾了。")]),t._v(" "),n("p",[n("strong",[t._v("示例：移动到相对位置并返回")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" relPos "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createRelativePositionFromTypeIndex")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" pos "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createAbsolutePositionFromRelativePosition")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("relPos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" doc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\npos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" ytext "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// => true")]),t._v("\npos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// => true")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("p",[n("strong",[t._v("示例：向远程客户端发送相对位置(json)")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" relPos "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createRelativePositionFromTypeIndex")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" encodedRelPos "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("relPos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 向远程客户端发送 encodedRelPos。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" parsedRelPos "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("encodedRelPos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" pos "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createAbsolutePositionFromRelativePosition")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parsedRelPos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" remoteDoc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\npos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" remoteytext "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// => true")]),t._v("\npos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// => true")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])]),n("p",[n("strong",[t._v("示例：发送相对位置到远程客户端(Uint8Array)")])]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" relPos "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createRelativePositionFromTypeIndex")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" encodedRelPos "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeRelativePosition")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("relPos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 向远程客户端发送 encodedRelPos。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" parsedRelPos "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("decodeRelativePosition")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("encodedRelPos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" pos "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("Y")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createAbsolutePositionFromRelativePosition")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parsedRelPos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" remoteDoc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\npos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" remoteytext "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// => true")]),t._v("\npos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// => true")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])]),n("h3",{attrs:{id:"y-createrelativepositionfromtypeindex-uint8array-y-type-number"}},[n("code",[t._v("Y.createRelativePositionFromTypeIndex(Uint8Array|Y.Type, number)")])]),t._v(" "),n("h3",{attrs:{id:"y-createabsolutepositionfromrelativeposition-relativeposition-y-doc"}},[n("code",[t._v("Y.createAbsolutePositionFromRelativePosition(RelativePosition, Y.Doc)")])]),t._v(" "),n("h3",{attrs:{id:"y-encoderelativeposition-relativeposition-uint8array"}},[n("code",[t._v("Y.encodeRelativePosition(RelativePosition):Uint8Array")])]),t._v(" "),n("h3",{attrs:{id:"y-decoderelativeposition-uint8array-relativeposition"}},[n("code",[t._v("Y.decodeRelativePosition(Uint8Array):RelativePosition")])]),t._v(" "),n("h2",{attrs:{id:"y-undomanager"}},[t._v("Y.UndoManager")]),t._v(" "),n("p",[t._v("Yjs 自带了撤销/重做管理器，用以应对 Yjs 类型的撤销/重做。可以选择将更改的范围限定到起始事件流程。")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ytext "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" doc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getText")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" undoManager "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UndoManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'abc'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nundoManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("undo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// => ''")]),t._v("\nundoManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("redo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// => 'abc'")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br")])]),n("h3",{attrs:{id:"constructor-scope-y-abstracttype-array-y-abstracttype-capturetimeout-number-trackedorigins-set-any-deletefilter-function-item-boolean"}},[n("code",[t._v("constructor(scope:Y.AbstractType|Array<Y.AbstractType> [, {captureTimeout:number,trackedOrigins:Set<any>,deleteFilter:function(item):boolean}])")])]),t._v(" "),n("p",[t._v("可以接受单个类型作为范围，也可以接受类型数组。")]),t._v(" "),n("h3",{attrs:{id:"undo"}},[n("code",[t._v("undo()")])]),t._v(" "),n("h3",{attrs:{id:"redo"}},[n("code",[t._v("redo()")])]),t._v(" "),n("h3",{attrs:{id:"stopcapturing"}},[n("code",[t._v("stopCapturing()")])]),t._v(" "),n("h3",{attrs:{id:"on-stack-item-added-stackitem-meta-map-any-any-type-undo-redo"}},[n("code",[t._v("on('stack-item-added', { stackItem: { meta: Map<any,any> }, type: 'undo' | 'redo' })")])]),t._v(" "),n("p",[t._v("注册当"),n("code",[t._v("StackItem")]),t._v("添加到撤销栈或重做栈时调用的事件。")]),t._v(" "),n("h3",{attrs:{id:"on-stack-item-popped-stackitem-meta-map-any-any-type-undo-redo"}},[n("code",[t._v("on('stack-item-popped', { stackItem: { meta: Map<any,any> }, type: 'undo' | 'redo' })")])]),t._v(" "),n("p",[t._v("注册当"),n("code",[t._v("StackItem")]),t._v("从撤销栈或重做栈移出时调用的事件。")]),t._v(" "),n("p",[n("strong",[t._v("示例：停止捕获")])]),t._v(" "),n("p",[t._v("如果创建的时间间隔小于"),n("code",[t._v("options.captureTimeout")]),t._v("，则"),n("code",[t._v("UndoManager")]),t._v("会合并"),n("code",[t._v("Undo-StackItem")]),t._v("。调用"),n("code",[t._v("um.stopCapturing()")]),t._v("可以避免下一个"),n("code",[t._v("StackItem")]),t._v("被合并。")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 无停止捕获")]),t._v("\nytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'b'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nundoManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("undo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// => '' (注意 'ab' 被移除了)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 带停止捕获")]),t._v("\nytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nundoManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stopCapturing")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'b'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nundoManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("undo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// => 'a' (注意只有 'b' 被)")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br")])]),n("p",[n("strong",[t._v("示例：指定追踪的起始点")])]),t._v(" "),n("p",[t._v("共享文档上的每个更改都有一个起始点。如果没有指定起始点，则默认为"),n("code",[t._v("null")]),t._v("。通过指定"),n("code",[t._v("trackedOrigins")]),t._v("您可以有选择地指定"),n("code",[t._v("UndoManager")]),t._v("应该跟踪哪些更改。"),n("code",[t._v("UndoManager")]),t._v("实例总会被添加到"),n("code",[t._v("trackedOrigins")]),t._v("中。")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CustomBinding")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ytext "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" doc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getText")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" undoManager "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UndoManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  trackedOrigins"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" CustomBinding"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'abc'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nundoManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("undo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// => 'abc' (不跟踪，因为起始点“null”并且不是“trackedTransactionOrigins”的一部分)")]),t._v("\nytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 恢复")]),t._v("\n\ndoc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("transact")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'abc'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nundoManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("undo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// => '' (跟踪，因为起始点是“trackedTransactionOrigins”的一部分)")]),t._v("\n\ndoc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("transact")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'abc'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("41")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nundoManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("undo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// => '' (不跟踪，因为 41 不是“trackedTransactionOrigins”的一部分)")]),t._v("\nytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 恢复")]),t._v("\n\ndoc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("transact")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'abc'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CustomBinding")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nundoManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("undo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// => '' (跟踪，因为起始点 `CustomBinding` 和 `CustomBinding`是 `trackedTransactionorigins`的一部分)")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br")])]),n("p",[n("strong",[t._v("示例：向"),n("code",[t._v("StackItems")]),t._v("添加其他信息")])]),t._v(" "),n("p",[t._v("在撤消或重做以前的操作时，通常需要恢复其他元信息，如光标位置或文档上的视图。您可以为"),n("code",[t._v("Undo-/Redo-StackItems")]),t._v("分配元信息。")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ytext "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" doc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getText")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" undoManager "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UndoManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ytext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  trackedOrigins"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" CustomBinding"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nundoManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'stack-item-added'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 保存 stack-item 的当前光标位置")]),t._v("\n  event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stackItem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("meta"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cursor-location'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getRelativeCursorLocation")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nundoManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'stack-item-popped'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 储存 stack-item 的当前光标位置")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("restoreCursorLocation")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stackItem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("meta"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cursor-location'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);